import{e as N,u as X,f as M,g as Z,j as ee,t as se,h as le,i as S,k as Q,l as e,m as ae,w as te,s as re,R as I,n as ie,p as ue,q as oe,v as ce,x as ne,y as B,z as T,A as ve,B as de,C as me,D as he,L as ye,E as pe,F as ge,G as fe,H as U,I as xe,J as R}from"./app-RocUtrj_.js";const He=["/","/computer/start.html","/computer/Linux/Linux.html","/computer/Linux/Linux%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5.html","/computer/vcs/git%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97.html","/computer/vcs/svn%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97.html","/404.html","/computer/","/computer/Linux/","/computer/vcs/","/category/","/tag/","/article/","/star/","/timeline/"],Ee="SLIMSEARCH_QUERY_HISTORY",g=U(Ee,[]),Qe=()=>{const{queryHistoryCount:t}=R;return{enabled:t>0,queryHistories:g,addQueryHistory:o=>{g.value=Array.from(new Set([o,...g.value.slice(0,t-1)]))},removeQueryHistory:o=>{g.value=[...g.value.slice(0,o),...g.value.slice(o+1)]}}},q=t=>He[t.id]+("anchor"in t?`#${t.anchor}`:""),Re="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=R,f=U(Re,[]),we=()=>({enabled:j>0,resultHistories:f,addResultHistory:u=>{{const o={link:q(u),display:u.display};"header"in u&&(o.header=u.header),f.value=[o,...f.value.slice(0,j-1)]}},removeResultHistory:u=>{f.value=[...f.value.slice(0,u),...f.value.slice(u+1)]}}),be=t=>{const u=ve(),o=M(),w=de(),r=S(0),x=Q(()=>r.value>0),v=me([]);return he(()=>{const{search:b,terminate:h}=ye(),H=ge(y=>{const{resultsFilter:k=a=>a,querySplitter:p,suggestionsFilter:D,...i}=u.value;y?(r.value+=1,b(y,o.value,i).then(a=>k(a,y,o.value,w.value)).then(a=>{r.value-=1,v.value=a}).catch(a=>{console.warn(a),r.value-=1,r.value||(v.value=[])})):v.value=[]},R.searchDelay-R.suggestDelay,{maxWait:5e3});pe([t,o],([y])=>H(y.join(" "))),fe(()=>{h()})}),{isSearching:x,results:v}};var Ae=N({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:u}){const o=X(),w=M(),r=Z(ee),{addQueryHistory:x,queryHistories:v,removeQueryHistory:b}=Qe(),{resultHistories:h,addResultHistory:H,removeResultHistory:y}=we(),k=se(t,"queries"),{results:p,isSearching:D}=be(k),i=le({isQuery:!0,index:0}),a=S(0),d=S(0),F=Q(()=>v.value.length>0||h.value.length>0),A=Q(()=>p.value.length>0),C=Q(()=>p.value[a.value]||null),_=()=>{const{isQuery:s,index:l}=i;l===0?(i.isQuery=!s,i.index=s?h.value.length-1:v.value.length-1):i.index=l-1},O=()=>{const{isQuery:s,index:l}=i;l===(s?v.value.length-1:h.value.length-1)?(i.isQuery=!s,i.index=0):i.index=l+1},P=()=>{a.value=a.value>0?a.value-1:p.value.length-1,d.value=C.value.contents.length-1},Y=()=>{a.value=a.value<p.value.length-1?a.value+1:0,d.value=0},z=()=>{d.value<C.value.contents.length-1?d.value+=1:Y()},G=()=>{d.value>0?d.value-=1:P()},L=s=>s.map(l=>xe(l)?l:e(l[0],l[1])),J=s=>{if(s.type==="customField"){const l=ce[s.index]||"$content",[m,c=""]=ne(l)?l[w.value].split("$content"):l.split("$content");return s.display.map(n=>e("div",L([m,...n,c])))}return s.display.map(l=>e("div",L(l)))},E=()=>{a.value=0,d.value=0,u("updateQuery",""),u("close")},V=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},v.value.map((s,l)=>{const m=i.isQuery&&i.index===l;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m,onClick:()=>{u("updateQuery",s)}},e("div",[e(B,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:c=>{c.preventDefault(),c.stopPropagation(),b(l)}})]))}))])),W=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},h.value.map((s,l)=>{const m=!i.isQuery&&i.index===l;return e("li",{class:["slimsearch-record-matches",{active:m}],role:"option","aria-selected":m},e(I,{to:s.link,onClick:()=>{E()}},()=>[e(B,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(c=>L(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:c=>{c.preventDefault(),c.stopPropagation(),y(l)}})]))}))]));return ae("keydown",s=>{if(t.isFocusing){if(A.value){if(s.key==="ArrowUp")G();else if(s.key==="ArrowDown")z();else if(s.key==="Enter"){const l=C.value.contents[d.value];x(t.queries.join(" ")),H(l),o.push(q(l)),E()}}else if(s.key==="ArrowUp")_();else if(s.key==="ArrowDown")O();else if(s.key==="Enter"){const{index:l}=i;i.isQuery?(s.preventDefault(),u("updateQuery",v.value[l])):(o.push(h.value[l].link),E())}}}),te([a,d],()=>{var s;(s=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||s.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!A.value:!F.value}]},t.queries.length?D.value?e(re,{hint:r.value.searching}):A.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:s,contents:l},m)=>{const c=a.value===m;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},l.map((n,K)=>{const $=c&&d.value===K;return e("li",{class:["slimsearch-record-matches",{active:$}],role:"option","aria-selected":$},e(I,{to:q(n),onClick:()=>{x(t.queries.join(" ")),H(n),E()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?ue:oe,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",J(n))])]))}))])})):r.value.emptyResult:F.value?[V(),W()]:r.value.emptyHistory)}});export{Ae as default};
